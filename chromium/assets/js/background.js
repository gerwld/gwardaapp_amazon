//   - This file is part of GwardaApp Extension
//  <https://github.com/gerwld/GwardaApp-extension/blob/main/README.md>,
//   - Copyright (C) 2023-present GwardaApp Extension
//   -
//   - GwardaApp Extension is a software: you can redistribute it, but you are not allowed to modify it under the terms of the Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) License.
//   -
//   - GwardaApp Extension is distributed in the hope that it will be useful,
//   - but WITHOUT ANY WARRANTY; without even the implied warranty of
//   - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//   - Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) License for more details.
//   -
//   - You should have received a copy of the Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) License
//   - along with GwardaApp Extension.  If not, see <https://creativecommons.org/licenses/by-nc-nd/4.0/>.

// Note: Amazon is a registered trademark of Amazon and all related Marks are Trademarks of Amazon.com, Inc. or its affiliates. This extension is not affiliated with or endorsed by Amazon.com, Inc or / and its affiliates.


!function(){"use strict";function e(e){return e.replace(/<head\b[^<]*(?:(?!<\/head>)<[^<]*)*<\/head>/gi,"").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<link\b[^>]*>/gi,"").replace(/<meta\b[^>]*>/gi,"").replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,"").replace(/<svg\b[^<]*(?:(?!<\/svg>)<[^<]*)*<\/svg>/gi,"").replace(/<\!--[\s\S]*?-->/g,"").replace(/onload/g,"soup-onload").replace(/\s+/g," ")}const t={disabled:!0,dark_mode:!1,gn_keywords:!0,stock_status:!0,lqs:!0,quick_view:!0,public_data:!0},r=chrome||browser;function a(e){e/1024/1024>4&&r.storage.local.remove("gpCache",(function(){}))}r.runtime.onInstalled.addListener((function(){r.storage.sync.get("cookies_gal20",(e=>{e?.cookies_gal20||(r.storage.local.set({gpState:{...t,disabled:!0}}),r.tabs.create({url:"/content/preferences.html"}))}))})),r.storage.local.get("gpState",(e=>{r.storage.local.set({gpState:{...t,...e?.gpState}})})),r.storage.local?.getBytesInUse?r.storage.local.getBytesInUse(null,(function(e){a(e)})):r.storage.local.get(null,(function(e){a(JSON.stringify(e).length)})),r.storage.local.get("gpCache",(function(e){if(e?.gpCache&&e.gpCache.length){let t=[],a=e.gpCache.filter((e=>{let r=e?.timestamp+864e5>Date.now();return r||t.push(e),r&&e}));r.storage.local.set({gpCache:[...a]})}})),r.runtime.onMessage.addListener(((t,a,n)=>"fetchData"===t.action?(async function(t,r="www.amazon.com"){if(!t||!t.length)return new Error("No data recieved in fetchInBackground (asin argument)");async function a(t){const a=Date.now();try{const n=await fetch(`https://${r}/dp/${t}?psc=1`);if(n.ok){let r=e(await n.text()+"");return r?{asin:t,data:r,timestamp:a}:o(t,"Failed to strip soup after response.ok")}}catch(e){return o(t,e)}}let n=3;async function o(e,t){return n>0?(n--,a(e)):new Error("Maximum retry limit reached.",t)}return Promise.all(t.map((e=>a(e))))}(t.arr).then((e=>{r.runtime.lastError||n(e)})).catch((e=>{n({error:"Error fetching data"})})),!0):"fetchStocks"===t.action?(async function(t,r="www.amazon.com"){if(!t||!t.length)return new Error("No data recieved in fetchInBackground (asin argument)");async function a(t){try{const a=await fetch(`https:///${r}/gp/product/ajax/ref=dp_aod_NEW_mbc?asin=${t}&m=&qid=&smid=&sourcecustomerorglistid=&sourcecustomerorglistitemid=&sr=&pc=dp&experienceId=aodAjaxMain`);if(a.ok){return e(await a.text()+"")||o(t,"Failed to strip soup after response.ok")}}catch(e){return o(t,e)}}let n=3;async function o(e,t){return n>0?(n--,a(e)):new Error("Maximum retry limit reached.",t)}return Promise.all(t.map((e=>a(e))))}(t.arr).then((e=>{r.runtime.lastError||n(e)})).catch((e=>{n({error:"Error fetching data"})})),!0):void 0))}();
